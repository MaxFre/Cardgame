let p=null,m=null,g=!1,y=1;function r(){if(p)return p;p=new(window.AudioContext||window.webkitAudioContext),m=p.createGain(),m.gain.value=y,m.connect(p.destination);const e=()=>{p.state==="suspended"&&p.resume()};return["pointerdown","keydown"].forEach(t=>window.addEventListener(t,e,{once:!1})),p}function l(e,t){e.connect(m),e.disconnect.bind(e),setTimeout(()=>{try{e.disconnect()}catch{}},(t+.3)*1e3)}function R(){const e=r(),t=e.currentTime,a=e.createBuffer(1,e.sampleRate*.12,e.sampleRate),n=a.getChannelData(0);for(let i=0;i<n.length;i++)n[i]=Math.random()*2-1;const c=e.createBufferSource();c.buffer=a;const o=e.createBiquadFilter();o.type="highpass",o.frequency.value=1200,c.connect(o);const s=e.createGain();s.gain.setValueAtTime(.55,t),s.gain.exponentialRampToValueAtTime(.001,t+.12),o.connect(s),l(s,.14),c.start(t),c.stop(t+.14)}function w(){const e=r(),t=e.currentTime,a=e.createOscillator();a.type="sine",a.frequency.setValueAtTime(280,t),a.frequency.linearRampToValueAtTime(880,t+.25),a.frequency.linearRampToValueAtTime(440,t+.5);const n=e.createGain();n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.35,t+.05),n.gain.linearRampToValueAtTime(.28,t+.25),n.gain.exponentialRampToValueAtTime(.001,t+.55),a.connect(n),l(n,.6),a.start(t),a.stop(t+.6)}function _(){const e=r(),t=e.currentTime,a=e.createBuffer(1,e.sampleRate*.35,e.sampleRate),n=a.getChannelData(0);for(let i=0;i<n.length;i++)n[i]=Math.random()*2-1;const c=e.createBufferSource();c.buffer=a;const o=e.createBiquadFilter();o.type="bandpass",o.frequency.value=600,o.Q.value=.8,c.connect(o);const s=e.createGain();s.gain.setValueAtTime(0,t),s.gain.linearRampToValueAtTime(.3,t+.08),s.gain.exponentialRampToValueAtTime(.001,t+.35),o.connect(s),l(s,.4),c.start(t),c.stop(t+.4)}function q(){const e=r(),t=e.currentTime,a=e.createOscillator();a.type="sine",a.frequency.setValueAtTime(180,t),a.frequency.exponentialRampToValueAtTime(35,t+.4);const n=e.createGain();n.gain.setValueAtTime(.6,t),n.gain.exponentialRampToValueAtTime(.001,t+.55),a.connect(n);const c=e.createBuffer(1,e.sampleRate*.15,e.sampleRate),o=c.getChannelData(0);for(let A=0;A<o.length;A++)o[A]=Math.random()*2-1;const s=e.createBufferSource();s.buffer=c;const i=e.createBiquadFilter();i.type="lowpass",i.frequency.value=300,s.connect(i);const d=e.createGain();d.gain.setValueAtTime(.45,t),d.gain.exponentialRampToValueAtTime(.001,t+.18),i.connect(d),l(n,.6),l(d,.2),a.start(t),a.stop(t+.6),s.start(t),s.stop(t+.2)}function v(){const e=r(),t=e.currentTime,a=e.createOscillator();a.type="square",a.frequency.setValueAtTime(220,t),a.frequency.exponentialRampToValueAtTime(660,t+.08),a.frequency.exponentialRampToValueAtTime(550,t+.2);const n=e.createGain();n.gain.setValueAtTime(.3,t),n.gain.linearRampToValueAtTime(.2,t+.1),n.gain.exponentialRampToValueAtTime(.001,t+.35),a.connect(n),l(n,.4),a.start(t),a.stop(t+.4)}function b(){const e=r(),t=e.currentTime;[523,659,784].forEach((a,n)=>{const c=e.createOscillator();c.type="sine",c.frequency.value=a;const o=e.createGain(),s=t+n*.07;o.gain.setValueAtTime(0,s),o.gain.linearRampToValueAtTime(.28,s+.01),o.gain.exponentialRampToValueAtTime(.001,s+.5),c.connect(o),l(o,.6),c.start(s),c.stop(s+.6)})}function B(){const e=r(),t=e.currentTime;[440,330].forEach((a,n)=>{const c=e.createOscillator();c.type="sine",c.frequency.value=a;const o=e.createGain(),s=t+n*.08;o.gain.setValueAtTime(.22,s),o.gain.exponentialRampToValueAtTime(.001,s+.12),c.connect(o),l(o,.25),c.start(s),c.stop(s+.25)})}function C(){const e=r(),t=e.currentTime,a=e.createOscillator();a.type="triangle",a.frequency.setValueAtTime(200,t),a.frequency.exponentialRampToValueAtTime(700,t+.18);const n=e.createGain();n.gain.setValueAtTime(.35,t),n.gain.exponentialRampToValueAtTime(.001,t+.22),a.connect(n),l(n,.25),a.start(t),a.stop(t+.25)}function G(){const e=r(),t=e.currentTime;[330,415,523].forEach((a,n)=>{const c=e.createOscillator();c.type="sine",c.frequency.value=a;const o=e.createGain(),s=t+n*.06;o.gain.setValueAtTime(.18,s),o.gain.exponentialRampToValueAtTime(.001,s+.4),c.connect(o),l(o,.5),c.start(s),c.stop(s+.5)})}function S(){const e=r(),t=e.currentTime;[220,185].forEach((a,n)=>{const c=e.createOscillator();c.type="sawtooth",c.frequency.setValueAtTime(a,t),c.frequency.exponentialRampToValueAtTime(a*.3,t+.3);const o=e.createGain();o.gain.setValueAtTime(.25-n*.05,t),o.gain.exponentialRampToValueAtTime(.001,t+.4),c.connect(o),l(o,.45),c.start(t),c.stop(t+.45)})}const T={};let u={};async function V(){try{await fetch("/api/save-sounds",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})}catch{}}async function h(e,t){try{const a=r(),c=await(await fetch(t)).arrayBuffer();T[e]=await a.decodeAudioData(c)}catch{delete T[e]}}function O(e,t=1){const a=r(),n=a.createBufferSource();n.buffer=e;const c=a.createGain();c.gain.value=t,n.connect(c),c.connect(m),n.start(a.currentTime)}const x=["hit","death","summon","draw","endTurn","battlecry","morale","heal","destroy","spell"],D={hit:R,spell:w,draw:_,death:q,battlecry:v,morale:b,endTurn:B,summon:C,heal:G,destroy:S},f={},E={play(e){if(g)return;const t=f[e]??1;if(T[e]){try{O(T[e],t)}catch{}return}const a=D[e];if(a)try{a()}catch{}},setVolume(e){y=Math.min(1,Math.max(0,e)),m&&(m.gain.value=g?0:y)},mute(e){g=e,m&&(m.gain.value=e?0:y)},get isMuted(){return g},async setCustom(e,t,a=1,n=null){f[e]=a,u[e]={dataUrl:t,volume:a,fname:n},await Promise.all([h(e,t),V()])},async clearCustom(e){delete T[e],delete u[e],await V()},async setKeyVolume(e,t){f[e]=t,u[e]&&(u[e].volume=t),await V()},async loadAllCustom(){try{const e=await fetch("/CreatedCards/sounds.json?t="+Date.now());if(!e.ok)return;u=await e.json()}catch{return}await Promise.all(x.map(async e=>{const t=u[e];t&&(typeof t.volume=="number"&&!isNaN(t.volume)&&(f[e]=t.volume),t.dataUrl&&await h(e,t.dataUrl))}))},getCustomInfo(){return Object.fromEntries(x.map(e=>{var t,a,n;return[e,{hasCustom:!!((t=u[e])!=null&&t.dataUrl),volume:f[e]??1,fname:((a=u[e])==null?void 0:a.fname)??null,dataUrl:((n=u[e])==null?void 0:n.dataUrl)??null}]}))}};export{E as S,x as a};
