import"./modulepreload-polyfill-3cfb730f.js";import{C as X,D as G,a as H,b as j}from"./AnimationSequencer-d646b041.js";const T={cardPlay:{label:"Card Play",phases:X,defaults:G,key:STORAGE_KEYS.cardPlay,note:"Runs after the card lands and springs back to normal."},combat:{label:"Combat",phases:H,defaults:j,key:STORAGE_KEYS.combat,note:"Controls the attack sequence when a minion attacks."}},w=7,S=60,Y=96,K=48;let y="cardPlay";const b={};for(const[n,e]of Object.entries(T))b[n]=e.defaults.map(o=>({...o}));let M=null;function C(){return document.getElementById("timeline-outer").clientWidth||800}function $(n,e){const o=e-S*2;return S+n*(o/(w-1))}function R(n,e){const o=e-S*2,l=(n-S)/(o/(w-1));return Math.max(0,Math.min(w-1,Math.round(l)))}function U(){const n=C(),e=b[y],o=new Map;for(const{id:s,slot:a}of e)o.has(a)||o.set(a,[]),o.get(a).push(s);const l={};for(const[s,a]of o){const r=a.length,i=$(s,n);a.forEach((d,c)=>{const f=(c-(r-1)/2)*K;l[d]={x:i,y:Y+f,slot:s}})}return l}function V(){document.getElementById("timeline-outer").querySelectorAll(".phase-dot, .phase-label, .slot-tick, .par-bracket").forEach(e=>e.remove())}function x(n,e,o={}){const l=document.createElement(n);return e&&(l.className=e),Object.assign(l.style,o),l}function E(){V();const n=document.getElementById("timeline-outer"),e=C(),o=T[y],l=b[y],s=U();for(let r=1;r<w-1;r++){const i=x("div","slot-tick",{left:$(r,e)+"px"});n.appendChild(i)}const a=new Map;for(const{id:r,slot:i}of l)a.has(i)||a.set(i,[]),a.get(i).push(r);for(const[,r]of a){if(r.length<2)continue;const i=r.map(p=>s[p].y),d=Math.min(...i),c=Math.max(...i),f=s[r[0]].x,h=x("div","par-bracket",{left:f+"px",top:d+"px",height:c-d+"px"});n.appendChild(h)}for(const{id:r}of l){const i=o.phases.find(A=>A.id===r);if(!i)continue;const d=s[r],c=x("div","phase-dot",{left:d.x+"px",top:d.y+"px",background:i.color+"cc",boxShadow:`0 0 14px ${i.color}55`});c.dataset.id=r,c.title=i.desc,c.textContent=i.icon;const f=x("div","dot-badge");f.textContent=d.slot,c.appendChild(f),c.addEventListener("mousedown",A=>{A.preventDefault(),c.classList.add("dragging"),M={id:r,dotEl:c,lblEl:document.querySelector(`.phase-label[data-id="${r}"]`),startMouseX:A.clientX,startDotX:d.x}}),n.appendChild(c);const h=x("div","phase-label",{left:d.x+"px",top:d.y+25+"px"});h.dataset.id=r;const p=x("div","lbl-name",{color:i.color});p.textContent=i.label,h.appendChild(p),n.appendChild(h)}z()}function z(){const n=document.getElementById("legend");n.innerHTML="";const e=T[y],o=[...b[y]].sort((l,s)=>l.slot-s.slot);for(const{id:l,slot:s}of o){const a=e.phases.find(c=>c.id===l);if(!a)continue;const r=o.filter(c=>c.slot===s&&c.id!==l).map(c=>{var f;return((f=e.phases.find(h=>h.id===c.id))==null?void 0:f.label)??c.id}),i=r.length?`Slot ${s} — parallel with ${r.join(", ")}`:`Slot ${s}`,d=x("div","legend-card",{borderColor:a.color+"55"});d.innerHTML=`
      <div class="legend-card-head">
        <span>${a.icon}</span>
        <span style="color:${a.color}">${a.label}</span>
      </div>
      <div class="legend-card-desc">${a.desc}</div>
      <div class="legend-card-slot">${i}</div>
    `,n.appendChild(d)}}document.addEventListener("mousemove",n=>{if(!M)return;const{dotEl:e,lblEl:o,startMouseX:l,startDotX:s}=M,a=C(),r=Math.max(S,Math.min(a-S,s+(n.clientX-l))),i=R(r,a);e.style.left=r+"px",o&&(o.style.left=r+"px");const d=e.querySelector(".dot-badge");d&&(d.textContent=i)});document.addEventListener("mouseup",n=>{if(!M)return;const{id:e,dotEl:o}=M;o.classList.remove("dragging");const l=C(),s=parseFloat(o.style.left),a=R(s,l),r=b[y].find(i=>i.id===e);r&&(r.slot=a),M=null,E()});document.getElementById("tabs").addEventListener("click",n=>{const e=n.target.closest(".tab");e&&(document.querySelectorAll(".tab").forEach(o=>o.classList.remove("active")),e.classList.add("active"),y=e.dataset.seq,E())});document.getElementById("save-btn").addEventListener("click",()=>{const n={animCardPlay:b.cardPlay,animCombat:b.combat};fetch("/api/save-layout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch(()=>{});const e=document.getElementById("toast");e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),2e3)});window.addEventListener("resize",E);document.getElementById("tabs").addEventListener("click",()=>{typeof I=="function"&&I()});(async function(){try{const e=await fetch("/CreatedCards/layout.json?t="+Date.now());if(!e.ok)return;const o=await e.json();for(const[l,s]of Object.entries(T)){const a=o[s.fileKey];Array.isArray(a)&&a.length===s.phases.length&&(b[l]=a.map(r=>({...r})))}}catch{}E()})();const q=document.getElementById("preview-canvas"),t=q.getContext("2d"),P=q.width,_=q.height,u=56,g=80,k=7,D=50,L={summon_vfx:740,battlecry_burst:640,on_play:820,lunge:470,clash_vfx:510,damage:600,snap_back:460,death_vfx:690},J=210,m=n=>1-(1-n)**2;function N(n){return n==="cardPlay"?{main:{x:105,y:148,color:"#4a7eff",dx:0,alpha:1,label:"PLAY",atk:3,hp:4},enemy:{x:218,y:116,color:"#882222",dx:0,alpha:1,label:"ENEMY",atk:2,hp:5}}:{attacker:{x:70,y:162,color:"#44aa55",dx:0,alpha:1,label:"ATTKR",atk:4,hp:3},defender:{x:218,y:128,color:"#bb4444",dx:0,alpha:1,label:"DEFND",atk:2,hp:6}}}function v(n,e,o,l,s,a){n.beginPath(),n.moveTo(e+a,o),n.lineTo(e+l-a,o),n.quadraticCurveTo(e+l,o,e+l,o+a),n.lineTo(e+l,o+s-a),n.quadraticCurveTo(e+l,o+s,e+l-a,o+s),n.lineTo(e+a,o+s),n.quadraticCurveTo(e,o+s,e,o+s-a),n.lineTo(e,o+a),n.quadraticCurveTo(e,o,e+a,o),n.closePath()}function Q(n){if((n.alpha??1)<=0)return;const e=n.x+(n.dx??0),o=n.y,l=e-u/2,s=o-g/2;t.save(),t.globalAlpha=n.alpha??1,t.fillStyle="#131524",t.shadowBlur=10,t.shadowColor=n.color+"44",v(t,l,s,u,g,k),t.fill(),t.shadowBlur=0,t.save(),t.beginPath(),t.rect(l,s,u,22),t.clip(),t.globalAlpha=(n.alpha??1)*.65,t.fillStyle=n.color,v(t,l,s,u,g,k),t.fill(),t.restore(),t.globalAlpha=(n.alpha??1)*.38,t.strokeStyle=n.color,t.lineWidth=1.5,v(t,l,s,u,g,k),t.stroke(),t.globalAlpha=n.alpha??1,t.fillStyle="#ccc",t.font="bold 8px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText(n.label,e,o+14),t.font="9px monospace",t.fillStyle="#ff8888",t.textAlign="left",t.fillText(n.atk,l+4,s+g-8),t.fillStyle="#88ff88",t.textAlign="right",t.fillText(n.hp,l+u-4,s+g-8),t.restore()}function F(n){t.fillStyle="#060810",t.fillRect(0,0,P,_),t.strokeStyle="#0b0d1a",t.lineWidth=1;for(let e=0;e<P;e+=28)t.beginPath(),t.moveTo(e,0),t.lineTo(e,_),t.stroke();for(let e=0;e<_;e+=28)t.beginPath(),t.moveTo(0,e),t.lineTo(P,e),t.stroke();for(const e of Object.values(n))Q(e)}function Z(n,e,o){n==="lunge"&&e.attacker&&(e.attacker.dx=m(Math.min(1,o/.75))*D),n==="snap_back"&&e.attacker&&(e.attacker.dx=(1-m(o))*D),n==="death_vfx"&&e.defender&&(e.defender.alpha=Math.max(0,1-m(Math.min(1,o/.8))))}function tt(n,e,o){const l=e.main??e.attacker,s=e.enemy??e.defender;switch(n){case"summon_vfx":{const a=l.x,r=l.y;for(let i=0;i<2;i++){const d=i*.12,c=.72,h=m(Math.max(0,(o-d)/c))*72,p=Math.max(0,1-m(Math.max(0,(o-d-.18)/.6)));t.save(),t.globalAlpha=p*(i===0?.85:.5),t.strokeStyle=l.color,t.lineWidth=i===0?2.5:1.5,t.shadowBlur=10,t.shadowColor=l.color,t.beginPath(),t.arc(a,r,Math.max(.5,h),0,Math.PI*2),t.stroke(),t.restore()}break}case"battlecry_burst":{const a=l.x,r=l.y;for(let i=0;i<3;i++){const d=i*.17,c=m(Math.max(0,(o-d)/(1-d))),f=c*65,h=Math.max(0,1-c);t.save(),t.globalAlpha=h*.72,t.strokeStyle="#ff9f43",t.lineWidth=1.8+i*.5,t.shadowBlur=7,t.shadowColor="#ff9f43",t.beginPath(),t.arc(a,r,Math.max(.5,f),0,Math.PI*2),t.stroke(),t.restore()}if(o>.28){const i=(o-.28)/.72;for(let d=0;d<8;d++){const c=d/8*Math.PI*2+.4,f=m(i)*55;t.save(),t.globalAlpha=(1-i)*.9,t.fillStyle="#ffcc44",t.beginPath(),t.arc(a+Math.cos(c)*f,r+Math.sin(c)*f,2.5,0,Math.PI*2),t.fill(),t.restore()}}break}case"on_play":{if(!s)break;const a=l.x+(l.dx??0),r=l.y,i=s.x+(s.dx??0),d=s.y;if(o<.55){const f=m(o/.5),h=a+(i-a)*f,p=r+(d-r)*f;t.save(),t.globalAlpha=.85,t.strokeStyle="#ff6b6b",t.lineWidth=2,t.shadowBlur=6,t.shadowColor="#ff6b6b",t.setLineDash([6,4]),t.beginPath(),t.moveTo(a,r),t.lineTo(h,p),t.stroke(),t.restore()}const c=Math.max(0,Math.min(1,(o-.5)/.22));if(c>0&&c<1&&(t.save(),t.globalAlpha=(1-c)*.48,t.fillStyle="#ff3333",v(t,i-u/2,d-g/2,u,g,k),t.fill(),t.restore()),o>.52){const f=(o-.52)/.48;t.save(),t.globalAlpha=Math.min(1,f*2.5)*(1-Math.max(0,(f-.55)/.45)),t.fillStyle="#ff6666",t.font="bold 15px Georgia",t.textAlign="center",t.textBaseline="middle",t.shadowBlur=6,t.shadowColor="#ff2222",t.fillText("-3",i,d-28-m(f)*24),t.restore()}break}case"lunge":{if(!e.attacker)break;const a=e.attacker;(a.dx??0)>3&&(t.save(),t.globalAlpha=.15,t.fillStyle=a.color,v(t,a.x+(a.dx??0)*.4-u/2,a.y-g/2,u,g,k),t.fill(),t.restore());break}case"clash_vfx":{if(!e.attacker||!e.defender)break;const a=(e.attacker.x+(e.attacker.dx??0)+e.defender.x)/2,r=(e.attacker.y+e.defender.y)/2;for(let c=0;c<10;c++){const f=c/10*Math.PI*2,h=m(Math.min(1,o/.4))*28,p=Math.max(0,1-m(Math.max(0,(o-.28)/.72)));t.save(),t.globalAlpha=p*.9,t.strokeStyle=c%2===0?"#ffcc44":"#ff9f43",t.lineWidth=2.2,t.shadowBlur=6,t.shadowColor="#ffcc44",t.beginPath(),t.moveTo(a+Math.cos(f)*3,r+Math.sin(f)*3),t.lineTo(a+Math.cos(f)*(3+h),r+Math.sin(f)*(3+h)),t.stroke(),t.restore()}const i=m(Math.min(1,o/.22))*14,d=Math.max(0,1-m(Math.min(1,o/.28)));t.save(),t.globalAlpha=d*.7,t.fillStyle="#ffffaa",t.shadowBlur=14,t.shadowColor="#fff",t.beginPath(),t.arc(a,r,Math.max(.1,i),0,Math.PI*2),t.fill(),t.restore();break}case"damage":{if(!e.attacker||!e.defender)break;const a=e.attacker.x+(e.attacker.dx??0),r=e.attacker.y,i=e.defender.x,d=e.defender.y,c=Math.max(0,1-m(o/.38));c>0&&(t.save(),t.globalAlpha=c*.52,t.fillStyle="#ff2222",v(t,i-u/2,d-g/2,u,g,k),t.fill(),t.restore());const f=m(Math.min(1,o/.9)),h=1-Math.max(0,(o-.68)/.32);t.save(),t.globalAlpha=h,t.fillStyle="#ff5555",t.font="bold 16px Georgia",t.textAlign="center",t.textBaseline="middle",t.shadowBlur=6,t.shadowColor="#ff0000",t.fillText("-3",i,d-26-f*22),t.globalAlpha=h*.75,t.fillStyle="#ff9988",t.font="bold 12px Georgia",t.fillText("-1",a,r-22-f*16),t.restore();break}case"snap_back":{if(!e.attacker)break;const a=e.attacker;(a.dx??0)>3&&(t.save(),t.globalAlpha=.12,t.fillStyle=a.color,v(t,a.x+(a.dx??0)+u*.35-u/2,a.y-g/2,u,g,k),t.fill(),t.restore());break}case"death_vfx":{if(!e.defender)break;const a=e.defender.x,r=e.defender.y,i=m(Math.min(1,o/.68)),d=Math.max(0,1-i);if(t.save(),t.globalAlpha=d*.65,t.strokeStyle="#888",t.lineWidth=2,t.shadowBlur=7,t.shadowColor="#aaa",t.beginPath(),t.arc(a,r,Math.max(.1,i*62),0,Math.PI*2),t.stroke(),t.restore(),o>.1){const c=Math.min(1,(o-.1)/.65);for(let f=0;f<8;f++){const h=f/8*Math.PI*2+.3,p=m(c)*42;t.save(),t.globalAlpha=(1-c)*.8,t.fillStyle="#888",t.beginPath(),t.arc(a+Math.cos(h)*p,r+Math.sin(h)*p,2.5,0,Math.PI*2),t.fill(),t.restore()}}break}}}function W(){const n=T[y],e=[...b[y]].sort((s,a)=>s.slot-a.slot),o=document.getElementById("phase-log");o.innerHTML="";let l=-1;for(const{id:s,slot:a}of e){const r=n.phases.find(c=>c.id===s);if(!r)continue;const i=a===l,d=document.createElement("div");d.className="log-row pending"+(i?" parallel":""),d.dataset.pid=s,d.style.setProperty("--pc",r.color),d.innerHTML=`<span class="log-slot">${a}</span><span class="log-icon">${r.icon}</span><span class="log-name" style="color:${r.color}">${r.label}</span><span class="log-status"></span>`,o.appendChild(d),l=a}}function O(n,e){for(const o of n){const l=document.querySelector(`.log-row[data-pid="${o}"]`);if(l){l.className=l.className.replace(/\b(pending|playing|done)\b/g,"").trim()+" "+e;const a=l.querySelector(".log-status");a&&(a.textContent=e==="done"?"✓":e==="playing"?"●":"")}const s=document.querySelector(`.phase-dot[data-id="${o}"]`);s&&(e==="playing"?s.classList.add("playing"):s.classList.remove("playing"))}}function I(){F(N(y)),W()}let B=!1;async function et(){if(B)return;B=!0,document.getElementById("play-btn").disabled=!0;const n=b[y],e=N(y);W();const o=new Map;for(const{id:s,slot:a}of n)o.has(a)||o.set(a,[]),o.get(a).push(s);const l=[...o.keys()].sort((s,a)=>s-a);for(let s=0;s<l.length;s++){const a=o.get(l[s]);O(a,"playing");const r=Math.max(...a.map(i=>L[i]??600));await new Promise(i=>{const d=performance.now(),c=()=>{const f=performance.now()-d;for(const h of a){const p=Math.min(1,f/(L[h]??600));Z(h,e,p)}F(e);for(const h of a){const p=Math.min(1,f/(L[h]??600));tt(h,e,p)}f<r?requestAnimationFrame(c):i()};requestAnimationFrame(c)}),O(a,"done"),s<l.length-1&&await new Promise(i=>setTimeout(i,J))}B=!1,document.getElementById("play-btn").disabled=!1}document.getElementById("play-btn").addEventListener("click",et);I();
