import"./modulepreload-polyfill-3cfb730f.js";import{A as Z,a as O,i as ee,C as te,G as ne}from"./BoardForrest-927fe922.js";import{V as ae}from"./VFX-c64be62e.js";import{f as se}from"./OnFieldFrame-3e1ae940.js";import"./SoundManager-7983c1fd.js";const le=""+new URL("Captain-f8f77f24.png",import.meta.url).href,oe=""+new URL("Drake-1974ecab.png",import.meta.url).href,ie=""+new URL("GreenDino-1df5361d.png",import.meta.url).href,re=""+new URL("Priestess-c6624b40.png",import.meta.url).href,ce=""+new URL("Huntress-cedb8245.png",import.meta.url).href,pe=""+new URL("witch-4a265cb6.png",import.meta.url).href,U=[le,oe,ie,re,ce,pe];function V(e,a){const n=new te;n.x=e,n.y=a;const t=0,i=-18,s=44,o=new ne;o.beginFill(16777215),o.drawCircle(t,i,s),o.endFill(),n.addChild(o);const r=U[Math.floor(Math.random()*U.length)],d=O.from(r);d.anchor.set(.5),d.x=t,d.y=i,d.width=s*2,d.height=s*2,d.mask=o,n.addChild(d);const c=O.from(se);return c.anchor.set(.5),c.width=128,c.height=192,n.addChild(c),n}const de={burst:"#7c3aed",ring:"#1d4ed8",shake:"#dc2626",text:"#d97706",rise:"#16a34a",flash:"#0891b2",fire:"#e85d04"},$={burst:[{key:"color",label:"Color",type:"color",default:"#ffd700"},{key:"count",label:"Particle Count",type:"range",min:1,max:80,step:1,default:20},{key:"minDist",label:"Min Distance",type:"range",min:0,max:300,step:5,default:30},{key:"maxDist",label:"Max Distance",type:"range",min:0,max:500,step:5,default:80},{key:"minSize",label:"Min Particle Size",type:"range",min:1,max:30,step:1,default:3},{key:"maxSize",label:"Max Particle Size",type:"range",min:1,max:30,step:1,default:7},{key:"duration",label:"Duration (ms)",type:"range",min:100,max:3e3,step:50,default:600},{key:"delay",label:"Start Delay (ms)",type:"range",min:0,max:3e3,step:50,default:0}],ring:[{key:"color",label:"Color",type:"color",default:"#ffd700"},{key:"radius",label:"Max Radius",type:"range",min:10,max:400,step:5,default:80},{key:"duration",label:"Duration (ms)",type:"range",min:60,max:2e3,step:20,default:280},{key:"delay",label:"Start Delay (ms)",type:"range",min:0,max:3e3,step:50,default:0}],shake:[{key:"intensity",label:"Intensity (px)",type:"range",min:1,max:40,step:1,default:8},{key:"duration",label:"Duration (ms)",type:"range",min:50,max:2e3,step:25,default:300},{key:"delay",label:"Start Delay (ms)",type:"range",min:0,max:3e3,step:50,default:0}],text:[{key:"content",label:"Text",type:"text",default:"!"},{key:"color",label:"Color",type:"color",default:"#ffd700"},{key:"size",label:"Font Size",type:"range",min:12,max:120,step:2,default:58},{key:"riseY",label:"Rise Height",type:"range",min:0,max:300,step:5,default:80},{key:"duration",label:"Duration (ms)",type:"range",min:200,max:3e3,step:50,default:700},{key:"delay",label:"Start Delay (ms)",type:"range",min:0,max:3e3,step:50,default:0}],rise:[{key:"color",label:"Color",type:"color",default:"#44ff88"},{key:"count",label:"Particle Count",type:"range",min:1,max:80,step:1,default:24},{key:"minSize",label:"Min Particle Size",type:"range",min:1,max:30,step:1,default:3},{key:"maxSize",label:"Max Particle Size",type:"range",min:1,max:30,step:1,default:8},{key:"riseHeight",label:"Rise Height",type:"range",min:40,max:400,step:10,default:160},{key:"duration",label:"Duration (ms)",type:"range",min:300,max:5e3,step:100,default:1400},{key:"delay",label:"Start Delay (ms)",type:"range",min:0,max:3e3,step:50,default:0}],flash:[{key:"color",label:"Color",type:"color",default:"#ffffff"},{key:"alpha",label:"Opacity",type:"range",min:.05,max:1,step:.05,default:.6},{key:"duration",label:"Duration (ms)",type:"range",min:50,max:1500,step:25,default:300},{key:"delay",label:"Start Delay (ms)",type:"range",min:0,max:3e3,step:50,default:0}],fire:[{key:"count",label:"Particle Count",type:"range",min:5,max:120,step:1,default:40},{key:"height",label:"Rise Height",type:"range",min:20,max:300,step:5,default:110},{key:"spread",label:"Horizontal Spread",type:"range",min:0,max:100,step:2,default:28},{key:"duration",label:"Duration (ms)",type:"range",min:200,max:4e3,step:50,default:900},{key:"delay",label:"Start Delay (ms)",type:"range",min:0,max:3e3,step:50,default:0}]};function me(e){const a=$[e]??[],n={type:e};for(const t of a)n[t.key]=t.default;return n}async function ue(e){try{await fetch("/api/save-vfx-presets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch{}}let l={},S=null,u=null,P=!1,j=null;function x(){return S?l[S]:null}function N(){var e;return((e=x())==null?void 0:e.steps)??[]}const B=1280,w=720,fe=48,I=new Z({backgroundColor:657944,antialias:!0,resolution:2,autoDensity:!0,width:B,height:w}),C=I.view;C.style.position="absolute";document.getElementById("app").appendChild(C);function A(){const e=window.innerWidth-240-280,a=window.innerHeight-fe,n=Math.min(e/B,a/w),t=Math.round(B*n),i=Math.round(w*n),s=document.getElementById("canvasWrap");s.style.width=t+"px",s.style.height=i+"px",C.style.width=t+"px",C.style.height=i+"px",C.style.left="0",C.style.top="0"}window.addEventListener("resize",A);A();const T=O.from(ee);T.alpha=.28;T.width=B;T.height=w;I.stage.addChild(T);const v=V(B*.28,w/2);I.stage.addChild(v);const R=V(B*.72,w/2);I.stage.addChild(R);const g=new ae(I);I.stage.addChild(g.container);function G(){const e=N();e.length&&g.playCustomEffect(e,v.x,v.y).catch(()=>{})}function ye(e){l._specialPresets||(l._specialPresets={});const a=document.getElementById(e+"Color"),n=document.getElementById(e+"Size"),t=document.getElementById(e+"Speed");a&&(l._specialPresets[e+"Color"]=a.value),n&&(l._specialPresets[e+"Size"]=Number(n.value)),t&&(l._specialPresets[e+"Speed"]=Number(t.value)),g._specialPresetsSync=l._specialPresets,g.testBolt(v.x,v.y,R.x,R.y,e).catch(()=>{})}window.previewBolt=ye;document.getElementById("playBtn").addEventListener("click",()=>{P?(P=!1,clearTimeout(j),document.getElementById("playBtn").textContent="▶ Play",document.getElementById("loopCheck").checked=!1):G()});document.getElementById("loopCheck").addEventListener("change",e=>{P=e.target.checked,document.getElementById("playBtn").textContent=P?"⏹ Stop":"▶ Play",P?q():clearTimeout(j)});function q(){if(!P)return;G();const e=Math.max(1200,...N().map(a=>(a.delay??0)+(a.duration??700)));j=setTimeout(q,e+300)}function J(){const e=["Folk","Wild","Magical"],a=l._factionPresets??{};for(const n of e){const t=document.getElementById("faction"+n);if(!t)continue;const i=a[n]??"";t.innerHTML='<option value="">— None (default flash) —</option>';for(const[s,o]of Object.entries(l)){if(s.startsWith("_"))continue;const r=document.createElement("option");r.value=s,r.textContent=o.name??s,s===i&&(r.selected=!0),t.appendChild(r)}}}["Folk","Wild","Magical"].forEach(e=>{const a=document.getElementById("faction"+e);a&&a.addEventListener("change",()=>{l._factionPresets||(l._factionPresets={}),l._factionPresets[e]=a.value||null,g._factionPresetsSync=l._factionPresets,E()})});function K(){const e=l._specialPresets??{},a=document.getElementById("specialBattlecry");if(a){const t=e.battlecry??"";a.innerHTML='<option value="">— Default —</option>';for(const[i,s]of Object.entries(l)){if(i.startsWith("_"))continue;const o=document.createElement("option");o.value=i,o.textContent=s.name??i,i===t&&(o.selected=!0),a.appendChild(o)}}const n=document.getElementById("specialDeath");if(n){const t=e.death??"";n.innerHTML='<option value="">— Default (explosion) —</option>';for(const[i,s]of Object.entries(l)){if(i.startsWith("_"))continue;const o=document.createElement("option");o.value=i,o.textContent=s.name??i,i===t&&(o.selected=!0),n.appendChild(o)}}[{key:"damageBolt",colorDef:"#ff6600",sizeDef:10,speedDef:320},{key:"moraleBolt",colorDef:"#cc1111",sizeDef:7,speedDef:380}].forEach(({key:t,colorDef:i,sizeDef:s,speedDef:o})=>{const r="special"+t.charAt(0).toUpperCase()+t.slice(1),d=document.getElementById(r);if(d){const Y=e[t]??"";d.innerHTML='<option value="">— Default —</option>';for(const[M,Q]of Object.entries(l)){if(M.startsWith("_"))continue;const H=document.createElement("option");H.value=M,H.textContent=Q.name??M,M===Y&&(H.selected=!0),d.appendChild(H)}}const c=document.getElementById(t+"Color"),p=document.getElementById(t+"Size"),m=document.getElementById(t+"Speed"),f=document.getElementById(t+"SpeedVal");c&&(c.value=e[t+"Color"]||i),p&&(p.value=e[t+"Size"]??s),m&&(m.value=e[t+"Speed"]??o),f&&(f.textContent=e[t+"Speed"]??o);const y=e[t+"Sprite"]||null,L=e[t+"SpriteScale"]??1,b=document.getElementById(t+"SpriteThumb"),D=document.getElementById(t+"SpriteEmpty"),k=document.getElementById(t+"SpriteScale"),W=document.getElementById(t+"SpriteScaleVal");b&&D&&(y?(b.src=y,b.style.display="",D.style.display="none"):(b.style.display="none",D.style.display="")),k&&(k.value=L),W&&(W.textContent=Number(L).toFixed(1))})}["battlecry","damageBolt","moraleBolt","death"].forEach(e=>{const a=e==="death"?"specialDeath":"special"+e.charAt(0).toUpperCase()+e.slice(1),n=document.getElementById(a);n&&n.addEventListener("change",()=>{l._specialPresets||(l._specialPresets={}),l._specialPresets[e]=n.value||null,g._specialPresetsSync=l._specialPresets,E()})});[{key:"damageBolt"},{key:"moraleBolt"}].forEach(({key:e})=>{const a=document.getElementById(e+"Color"),n=document.getElementById(e+"Size"),t=document.getElementById(e+"Speed"),i=document.getElementById(e+"SpeedVal"),s=document.getElementById(e+"SpriteScale"),o=document.getElementById(e+"SpriteScaleVal"),r=document.getElementById(e+"SpriteThumb"),d=document.getElementById(e+"SpriteEmpty"),c=document.getElementById(e+"SpritePick"),p=document.getElementById(e+"SpriteClear");function m(){l._specialPresets||(l._specialPresets={}),a&&(l._specialPresets[e+"Color"]=a.value),n&&(l._specialPresets[e+"Size"]=Number(n.value)),t&&(l._specialPresets[e+"Speed"]=Number(t.value)),s&&(l._specialPresets[e+"SpriteScale"]=Number(s.value)),g._specialPresetsSync=l._specialPresets,E()}a==null||a.addEventListener("input",m),n==null||n.addEventListener("input",m),t==null||t.addEventListener("input",y=>{i&&(i.textContent=y.target.value),m()}),s==null||s.addEventListener("input",y=>{o&&(o.textContent=Number(y.target.value).toFixed(1)),m()});const f=document.createElement("input");f.type="file",f.accept="image/png,image/webp,image/gif",f.style.display="none",document.body.appendChild(f),c==null||c.addEventListener("click",()=>f.click()),f.addEventListener("change",()=>{var b;const y=(b=f.files)==null?void 0:b[0];if(!y)return;const L=new FileReader;L.onload=D=>{const k=D.target.result;l._specialPresets||(l._specialPresets={}),l._specialPresets[e+"Sprite"]=k,E(),r&&(r.src=k,r.style.display=""),d&&(d.style.display="none"),g._specialPresetsSync=l._specialPresets},L.readAsDataURL(y),f.value=""}),p==null||p.addEventListener("click",()=>{l._specialPresets||(l._specialPresets={}),delete l._specialPresets[e+"Sprite"],E(),r&&(r.style.display="none"),d&&(d.style.display=""),g._specialPresetsSync=l._specialPresets})});function z(){var n;const e=document.getElementById("presetList");e.innerHTML="";for(const[t,i]of Object.entries(l)){if(t.startsWith("_"))continue;const s=document.createElement("div");s.className="preset-item"+(t===S?" active":""),s.innerHTML=`<span>${Ee(i.name)}</span><button class="del-btn" title="Delete">✕</button>`,s.querySelector("span").addEventListener("click",()=>F(t)),s.querySelector(".del-btn").addEventListener("click",o=>{o.stopPropagation(),X(t)}),e.appendChild(s)}const a=document.getElementById("presetName");a.value=((n=x())==null?void 0:n.name)??"",J(),K()}function F(e){var a;S=e,u=null,document.getElementById("presetName").value=((a=x())==null?void 0:a.name)??"",z(),h(),_()}function X(e){confirm("Delete this preset?")&&(delete l[e],S===e&&(S=Object.keys(l)[0]??null,u=null),z(),h(),_(),E())}document.getElementById("btnNew").addEventListener("click",()=>{const e="p_"+Date.now();l[e]={id:e,name:"New Effect",steps:[]},F(e),E(),document.getElementById("presetName").focus(),document.getElementById("presetName").select()});document.getElementById("btnDeletePreset").addEventListener("click",()=>{S&&X(S)});document.getElementById("presetName").addEventListener("input",e=>{const a=x();a&&(a.name=e.target.value,z())});function h(){const e=document.getElementById("stepList");e.innerHTML="",N().forEach((n,t)=>{const i=document.createElement("div");i.className="step-item"+(t===u?" active":"");const s=document.createElement("span");s.className="step-type-pill",s.style.background=de[n.type]??"#555",s.style.color="#fff",s.textContent=n.type,i.appendChild(s);const o=document.createElement("span");o.style.fontSize="11px",o.style.color="#778",o.textContent=ge(n),i.appendChild(o);const r=document.createElement("div");r.className="step-controls",r.innerHTML=`
      <button title="Move up"   onclick="event.stopPropagation();moveStep(${t},-1)">↑</button>
      <button title="Move down" onclick="event.stopPropagation();moveStep(${t},1)">↓</button>
      <button title="Delete"    onclick="event.stopPropagation();removeStep(${t})" style="color:#ef4444">✕</button>
    `,i.appendChild(r),i.addEventListener("click",()=>he(t)),e.appendChild(i)})}function ge(e){return e.type==="text"?`"${e.content??"!"}"`:e.type==="burst"?`×${e.count??18}`:e.type==="ring"?`r:${e.radius??80}`:e.type==="shake"?`±${e.intensity??8}px`:e.type==="rise"?`↑${e.riseHeight??160}`:e.type==="flash"?`${Math.round((e.alpha??.6)*100)}%`:""}function he(e){u=e,h(),_()}window.addStep=function(e){const a=x();a&&(a.steps.push(me(e)),u=a.steps.length-1,h(),_())};window.removeStep=function(e){const a=x();a&&(a.steps.splice(e,1),u>=a.steps.length&&(u=a.steps.length-1),u<0&&(u=null),h(),_())};window.moveStep=function(e,a){const n=x();if(!n)return;const t=e+a;t<0||t>=n.steps.length||([n.steps[e],n.steps[t]]=[n.steps[t],n.steps[e]],u===e&&(u=t),h())};function _(){const e=document.getElementById("inspectorBody");e.innerHTML="";const a=N();if(u===null||u>=a.length){e.innerHTML='<div id="noStep">Select a step to edit its properties.</div>';return}const n=a[u];($[n.type]??[]).forEach(s=>{const o=n[s.key]??s.default,r=document.createElement("div");r.className="field";const d=document.createElement("label");if(d.textContent=s.label,r.appendChild(d),s.type==="color"){const c=typeof o=="number"?"#"+o.toString(16).padStart(6,"0"):String(o).startsWith("#")?o:"#"+String(o).replace("0x","").padStart(6,"0"),p=document.createElement("input");p.type="color",p.value=c,p.addEventListener("input",m=>{n[s.key]=m.target.value,h()}),r.appendChild(p)}else if(s.type==="range"){const c=document.createElement("div");c.className="range-row";const p=document.createElement("input");p.type="range",p.min=s.min,p.max=s.max,p.step=s.step??1,p.value=o;const m=document.createElement("span");m.className="range-val",m.textContent=o,p.addEventListener("input",f=>{const y=parseFloat(f.target.value);n[s.key]=y,m.textContent=y,h()}),c.appendChild(p),c.appendChild(m),r.appendChild(c)}else if(s.type==="text"){const c=document.createElement("input");c.type="text",c.value=o,c.addEventListener("input",p=>{n[s.key]=p.target.value,h()}),r.appendChild(c)}e.appendChild(r)});const i=document.createElement("button");i.textContent="▶ Preview step",Object.assign(i.style,{margin:"12px 14px",padding:"6px 18px",background:"#3730a3",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px"}),i.addEventListener("click",()=>{g._runStep(n,v.x,v.y).catch(()=>{})}),e.appendChild(i)}async function E(){await ue(l)}document.getElementById("btnSave").addEventListener("click",async()=>{await E();const e=document.getElementById("savedBadge");e.style.opacity="1",setTimeout(()=>e.style.opacity="0",1600)});(async function(){try{const n=await fetch("/CreatedCards/vfx-presets.json?t="+Date.now());if(!n.ok)return;const t=await n.json();t&&typeof t=="object"&&Object.keys(t).length>0&&(l=t)}catch{}const a=Object.keys(l).filter(n=>!n.startsWith("_"));a.length>0?F(a[0]):z(),J(),K(),h(),_()})();function Ee(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}
